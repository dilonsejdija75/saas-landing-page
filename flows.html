<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Flows â€” Boostly</title>
  <link rel="stylesheet" href="css/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="index.html">Boostly</a>
      <nav class="nav">
        <a href="dashboard.html">Dashboard</a>
        <a href="flows.html">Flows</a>
        <a href="analytics.html">Analytics</a>
        <a href="settings.html">Settings</a>
        <div style="margin-left: auto; display: flex; align-items: center; gap: 1rem;">
          <span style="color: var(--muted); font-size: 0.9rem;">Trial: 13 days left</span>
          <div style="display: flex; align-items: center; gap: 0.5rem;">
            <div style="width: 32px; height: 32px; background: var(--primary); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 0.9rem;">JD</div>
            <a class="btn btn-ghost btn-sm" href="index.html">Logout</a>
          </div>
        </div>
      </nav>
    </div>
  </header>

  <main style="padding: 2rem 0;">
    <div class="container">
      <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 3rem;">
        <div>
          <h1>Onboarding Flows</h1>
          <p style="color: var(--muted);">Create and manage your conversion flows</p>
        </div>
        <button class="btn btn-primary" onclick="createFlow()">Create New Flow</button>
      </div>

      <!-- Flow Templates -->
      <div style="background: white; padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border); margin-bottom: 3rem;">
        <h3>Quick Start Templates</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 2rem; margin-top: 2rem;">
          <div style="border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 1.5rem;">
            <h4>Welcome Flow</h4>
            <p style="color: var(--muted); margin: 1rem 0;">Guide new users through key features and setup</p>
            <div style="margin: 1rem 0;">
              <span style="background: var(--border-light); padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem;">3 steps</span>
              <span style="background: var(--success); color: white; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem; margin-left: 0.5rem;">High converting</span>
            </div>
            <button class="btn btn-outline" onclick="useTemplate('Welcome Flow')">Use Template</button>
          </div>
          
          <div style="border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 1.5rem;">
            <h4>Upgrade Prompt</h4>
            <p style="color: var(--muted); margin: 1rem 0;">Convert trial users to paid subscriptions</p>
            <div style="margin: 1rem 0;">
              <span style="background: var(--border-light); padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem;">2 steps</span>
              <span style="background: var(--primary); color: white; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem; margin-left: 0.5rem;">Popular</span>
            </div>
            <button class="btn btn-outline" onclick="useTemplate('Upgrade Prompt')">Use Template</button>
          </div>

          <div style="border: 1px solid var(--border); border-radius: var(--radius-sm); padding: 1.5rem;">
            <h4>Feature Announcement</h4>
            <p style="color: var(--muted); margin: 1rem 0;">Highlight new features to existing users</p>
            <div style="margin: 1rem 0;">
              <span style="background: var(--border-light); padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem;">1 step</span>
              <span style="background: var(--accent); color: white; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem; margin-left: 0.5rem;">Simple</span>
            </div>
            <button class="btn btn-outline" onclick="useTemplate('Feature Announcement')">Use Template</button>
          </div>
        </div>
      </div>

      <!-- Active Flows -->
      <div style="background: white; padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border);">
        <h3>Your Flows</h3>
        <div id="flows-list" style="margin-top: 2rem;">
          <div style="text-align: center; padding: 3rem; color: var(--muted);">
            <div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“‹</div>
            <p>No flows created yet</p>
            <p style="font-size: 0.9rem;">Start with a template or create a custom flow</p>
          </div>
        </div>
      </div>
    </div>
  </main>

  <!-- Template Editor Modal -->
  <div id="template-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: var(--radius); width: 90%; max-width: 800px; max-height: 90%; overflow-y: auto;">
      <div style="padding: 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
        <h2 id="template-title">Template Editor</h2>
        <button onclick="closeTemplateModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">Ã—</button>
      </div>
      <div style="padding: 2rem;">
        <div id="template-content"></div>
        <div style="margin-top: 2rem; display: flex; gap: 1rem; justify-content: flex-end;">
          <button onclick="closeTemplateModal()" class="btn btn-outline">Cancel</button>
          <button onclick="saveTemplate()" class="btn btn-primary">Create Flow</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Stats Modal -->
  <div id="stats-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 2000;">
    <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); background: white; border-radius: var(--radius); width: 90%; max-width: 900px; max-height: 90%; overflow-y: auto;">
      <div style="padding: 2rem; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center;">
        <h2 id="stats-title">Flow Analytics</h2>
        <button onclick="closeStatsModal()" style="background: none; border: none; font-size: 1.5rem; cursor: pointer;">Ã—</button>
      </div>
      <div style="padding: 2rem;">
        <div id="stats-content"></div>
      </div>
    </div>
  </div>

  <script>
    function createFlow() {
      const name = prompt('Enter flow name:');
      if (name) {
        addFlow(name, 'Custom', 'Draft');
      }
    }

    const templates = {
      'Welcome Flow': {
        steps: [
          { title: 'Welcome Message', content: 'Welcome to our platform! Let\'s get you started.' },
          { title: 'Profile Setup', content: 'Complete your profile to personalize your experience.' },
          { title: 'First Action', content: 'Try creating your first project to see the magic happen!' }
        ]
      },
      'Upgrade Prompt': {
        steps: [
          { title: 'Feature Highlight', content: 'You\'ve been using our free features. Ready for more?' },
          { title: 'Upgrade Benefits', content: 'Unlock advanced analytics, priority support, and unlimited projects.' }
        ]
      },
      'Feature Announcement': {
        steps: [
          { title: 'New Feature Alert', content: 'We\'ve just launched an amazing new feature you\'ll love!' }
        ]
      }
    };

    function useTemplate(templateName) {
      showTemplateModal(templateName);
    }

    let currentTemplate = null;

    function showTemplateModal(templateName) {
      currentTemplate = JSON.parse(JSON.stringify(templates[templateName])); // Deep copy
      document.getElementById('template-title').textContent = templateName + ' Template';
      renderTemplateContent(templateName);
      document.getElementById('template-modal').style.display = 'block';
    }

    function renderTemplateContent(templateName) {
      let content = '<div style="margin-bottom: 2rem;">';
      content += '<label for="flow-name">Flow Name</label>';
      content += `<input id="flow-name" type="text" value="${templateName}" style="padding: 1rem; border: 2px solid var(--border); border-radius: var(--radius-sm); width: 100%; margin-top: 0.5rem;">`;
      content += '</div>';
      
      content += '<h4>Flow Steps</h4>';
      currentTemplate.steps.forEach((step, index) => {
        content += `<div id="step-${index}" style="background: var(--border-light); padding: 1.5rem; border-radius: var(--radius-sm); margin-bottom: 1rem;">`;
        content += `<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">`;
        content += `<h5 id="step-title-${index}">Step ${index + 1}: ${step.title}</h5>`;
        content += `<div><button onclick="editStep(${index})" id="edit-btn-${index}" class="btn btn-outline btn-sm">Edit</button>`;
        content += `<button onclick="saveStep(${index})" id="save-btn-${index}" class="btn btn-primary btn-sm" style="display: none; margin-left: 0.5rem;">Save</button></div>`;
        content += `</div>`;
        content += `<div id="step-content-${index}"><p style="margin: 0; color: var(--muted);">${step.content}</p></div>`;
        content += `</div>`;
      });
      
      document.getElementById('template-content').innerHTML = content;
    }

    function closeTemplateModal() {
      document.getElementById('template-modal').style.display = 'none';
    }

    function saveTemplate() {
      const flowName = document.getElementById('flow-name').value;
      const originalTitle = document.getElementById('template-title').textContent;
      
      if (originalTitle.startsWith('Edit ')) {
        // Update existing flow
        const originalName = originalTitle.replace('Edit ', '');
        if (createdFlows[originalName]) {
          createdFlows[originalName].steps = JSON.parse(JSON.stringify(currentTemplate.steps));
          if (flowName !== originalName) {
            createdFlows[flowName] = createdFlows[originalName];
            delete createdFlows[originalName];
          }
        }
        // Refresh the flows list
        refreshFlowsList();
      } else {
        // Create new flow
        addFlow(flowName, 'Template', 'Active');
      }
      closeTemplateModal();
    }

    function refreshFlowsList() {
      const flowsList = document.getElementById('flows-list');
      flowsList.innerHTML = '';
      
      // Reload from localStorage
      createdFlows = JSON.parse(localStorage.getItem('createdFlows') || '{}');
      
      if (Object.keys(createdFlows).length === 0) {
        flowsList.innerHTML = '<div style="text-align: center; padding: 3rem; color: var(--muted);"><div style="font-size: 3rem; margin-bottom: 1rem;">ðŸ“‹</div><p>No flows created yet</p><p style="font-size: 0.9rem;">Start with a template or create a custom flow</p></div>';
        return;
      }
      
      Object.values(createdFlows).forEach(flow => {
        const flowItem = document.createElement('div');
        flowItem.style = 'display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 1rem;';
        flowItem.innerHTML = `
          <div>
            <h4 style="margin: 0 0 0.5rem 0;">${flow.name}</h4>
            <div>
              <span style="background: var(--border-light); padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem;">${flow.type}</span>
              <span style="background: ${flow.status === 'Active' ? 'var(--success)' : 'var(--muted)'}; color: white; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem; margin-left: 0.5rem;">${flow.status}</span>
            </div>
          </div>
          <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-outline btn-sm" onclick="editFlow('${flow.name}')">Edit</button>
            <button class="btn btn-outline btn-sm" onclick="viewStats('${flow.name}')">Stats</button>
          </div>
        `;
        flowsList.appendChild(flowItem);
      });
    }

    function editStep(stepIndex) {
      const step = currentTemplate.steps[stepIndex];
      const titleElement = document.getElementById(`step-title-${stepIndex}`);
      const contentElement = document.getElementById(`step-content-${stepIndex}`);
      const editBtn = document.getElementById(`edit-btn-${stepIndex}`);
      const saveBtn = document.getElementById(`save-btn-${stepIndex}`);
      
      // Replace title with input
      titleElement.innerHTML = `Step ${stepIndex + 1}: <input id="title-input-${stepIndex}" type="text" value="${step.title}" style="padding: 0.5rem; border: 1px solid var(--border); border-radius: var(--radius-sm); margin-left: 0.5rem; width: 200px;">`;
      
      // Replace content with textarea
      contentElement.innerHTML = `<textarea id="content-input-${stepIndex}" style="width: 100%; padding: 1rem; border: 2px solid var(--border); border-radius: var(--radius-sm); min-height: 100px; resize: vertical;">${step.content}</textarea>`;
      
      // Toggle buttons
      editBtn.style.display = 'none';
      saveBtn.style.display = 'inline-block';
    }

    function saveStep(stepIndex) {
      const titleInput = document.getElementById(`title-input-${stepIndex}`);
      const contentInput = document.getElementById(`content-input-${stepIndex}`);
      const titleElement = document.getElementById(`step-title-${stepIndex}`);
      const contentElement = document.getElementById(`step-content-${stepIndex}`);
      const editBtn = document.getElementById(`edit-btn-${stepIndex}`);
      const saveBtn = document.getElementById(`save-btn-${stepIndex}`);
      
      // Update the template data
      currentTemplate.steps[stepIndex].title = titleInput.value;
      currentTemplate.steps[stepIndex].content = contentInput.value;
      
      // Update the display
      titleElement.innerHTML = `Step ${stepIndex + 1}: ${titleInput.value}`;
      contentElement.innerHTML = `<p style="margin: 0; color: var(--muted);">${contentInput.value}</p>`;
      
      // Toggle buttons
      editBtn.style.display = 'inline-block';
      saveBtn.style.display = 'none';
    }

    function deleteStep(stepIndex) {
      if (confirm('Are you sure you want to delete this step?')) {
        currentTemplate.steps.splice(stepIndex, 1);
        const flowName = document.getElementById('flow-name').value;
        renderFlowEditor(flowName);
      }
    }

    function addNewStep() {
      const newStep = {
        title: 'New Step',
        content: 'Enter your step content here...'
      };
      currentTemplate.steps.push(newStep);
      const flowName = document.getElementById('flow-name').value;
      renderFlowEditor(flowName);
    }

    let createdFlows = JSON.parse(localStorage.getItem('createdFlows') || '{}');
    
    // Load existing flows on page load
    document.addEventListener('DOMContentLoaded', function() {
      refreshFlowsList();
    });

    function addFlow(name, type, status) {
      const flowsList = document.getElementById('flows-list');
      if (flowsList.querySelector('div[style*="text-align: center"]')) {
        flowsList.innerHTML = '';
      }
      
      // Store flow data and set flag
      if (currentTemplate) {
        createdFlows[name] = {
          name: name,
          type: type,
          status: status,
          steps: JSON.parse(JSON.stringify(currentTemplate.steps))
        };
        localStorage.setItem('createdFlows', JSON.stringify(createdFlows));
        localStorage.setItem('hasCreatedFlows', 'true');
      }
      
      const flowItem = document.createElement('div');
      flowItem.style = 'display: flex; justify-content: space-between; align-items: center; padding: 1rem; border: 1px solid var(--border); border-radius: var(--radius-sm); margin-bottom: 1rem;';
      flowItem.innerHTML = `
        <div>
          <h4 style="margin: 0 0 0.5rem 0;">${name}</h4>
          <div>
            <span style="background: var(--border-light); padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem;">${type}</span>
            <span style="background: ${status === 'Active' ? 'var(--success)' : 'var(--muted)'}; color: white; padding: 0.25rem 0.5rem; border-radius: 3px; font-size: 0.8rem; margin-left: 0.5rem;">${status}</span>
          </div>
        </div>
        <div style="display: flex; gap: 0.5rem;">
          <button class="btn btn-outline btn-sm" onclick="editFlow('${name}')">Edit</button>
          <button class="btn btn-outline btn-sm" onclick="viewStats('${name}')">Stats</button>
        </div>
      `;
      flowsList.appendChild(flowItem);
    }

    function editFlow(name) {
      const flow = createdFlows[name];
      if (flow) {
        currentTemplate = { steps: JSON.parse(JSON.stringify(flow.steps)) };
        document.getElementById('template-title').textContent = `Edit ${name}`;
        renderFlowEditor(name);
        document.getElementById('template-modal').style.display = 'block';
      } else {
        alert(`Flow "${name}" not found. This may be a custom flow.`);
      }
    }

    function renderFlowEditor(flowName) {
      let content = '<div style="margin-bottom: 2rem;">';
      content += '<label for="flow-name">Flow Name</label>';
      content += `<input id="flow-name" type="text" value="${flowName}" style="padding: 1rem; border: 2px solid var(--border); border-radius: var(--radius-sm); width: 100%; margin-top: 0.5rem;">`;
      content += '</div>';
      
      content += '<h4>Flow Steps</h4>';
      currentTemplate.steps.forEach((step, index) => {
        content += `<div id="step-${index}" style="background: var(--border-light); padding: 1.5rem; border-radius: var(--radius-sm); margin-bottom: 1rem;">`;
        content += `<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1rem;">`;
        content += `<h5 id="step-title-${index}">Step ${index + 1}: ${step.title}</h5>`;
        content += `<div><button onclick="editStep(${index})" id="edit-btn-${index}" class="btn btn-outline btn-sm">Edit</button>`;
        content += `<button onclick="saveStep(${index})" id="save-btn-${index}" class="btn btn-primary btn-sm" style="display: none; margin-left: 0.5rem;">Save</button>`;
        content += `<button onclick="deleteStep(${index})" class="btn btn-outline btn-sm" style="margin-left: 0.5rem; color: #dc3545; border-color: #dc3545;">Delete</button></div>`;
        content += `</div>`;
        content += `<div id="step-content-${index}"><p style="margin: 0; color: var(--muted);">${step.content}</p></div>`;
        content += `</div>`;
      });
      
      content += '<button onclick="addNewStep()" class="btn btn-outline" style="width: 100%; margin-top: 1rem;">+ Add Step</button>';
      
      document.getElementById('template-content').innerHTML = content;
    }

    function viewStats(name) {
      showStatsModal(name);
    }

    function showStatsModal(flowName) {
      document.getElementById('stats-title').textContent = `${flowName} Analytics`;
      
      // Generate realistic stats based on flow name
      const stats = generateFlowStats(flowName);
      
      let content = '';
      
      // Key Metrics
      content += '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem; margin-bottom: 3rem;">';
      content += `<div style="background: var(--border-light); padding: 2rem; border-radius: var(--radius); text-align: center;">`;
      content += `<div style="font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;">${stats.views.toLocaleString()}</div>`;
      content += `<div style="color: var(--muted);">Total Views</div>`;
      content += `<div style="color: var(--success); font-size: 0.9rem; margin-top: 0.5rem;">â†— +${stats.viewsGrowth}% vs last month</div>`;
      content += `</div>`;
      
      content += `<div style="background: var(--border-light); padding: 2rem; border-radius: var(--radius); text-align: center;">`;
      content += `<div style="font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;">${stats.conversions.toLocaleString()}</div>`;
      content += `<div style="color: var(--muted);">Conversions</div>`;
      content += `<div style="color: var(--success); font-size: 0.9rem; margin-top: 0.5rem;">â†— +${stats.conversionsGrowth}% vs last month</div>`;
      content += `</div>`;
      
      content += `<div style="background: var(--border-light); padding: 2rem; border-radius: var(--radius); text-align: center;">`;
      content += `<div style="font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;">${stats.rate}%</div>`;
      content += `<div style="color: var(--muted);">Conversion Rate</div>`;
      content += `<div style="color: var(--success); font-size: 0.9rem; margin-top: 0.5rem;">â†— +${stats.rateGrowth}% vs last month</div>`;
      content += `</div>`;
      
      content += `<div style="background: var(--border-light); padding: 2rem; border-radius: var(--radius); text-align: center;">`;
      content += `<div style="font-size: 2.5rem; font-weight: 800; color: var(--primary); margin-bottom: 0.5rem;">Â£${stats.revenue.toLocaleString()}</div>`;
      content += `<div style="color: var(--muted);">Revenue Impact</div>`;
      content += `<div style="color: var(--success); font-size: 0.9rem; margin-top: 0.5rem;">â†— +Â£${stats.revenueGrowth.toLocaleString()} vs last month</div>`;
      content += `</div>`;
      content += '</div>';
      
      // Performance Chart
      content += '<div style="background: white; padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border); margin-bottom: 2rem;">';
      content += '<h3>Conversion Trend (Last 30 Days)</h3>';
      content += '<div style="height: 200px; position: relative; margin-top: 1rem; padding: 1rem; background: var(--border-light); border-radius: var(--radius-sm);">';
      
      // Generate chart data points
      const chartData = [];
      for (let i = 0; i < 30; i++) {
        const baseRate = stats.rate;
        const variation = (Math.random() - 0.5) * 4; // Â±2% variation
        chartData.push(Math.max(1, baseRate + variation));
      }
      
      // Create chart bars
      content += '<div style="display: flex; align-items: end; height: 160px; gap: 2px; padding: 0 1rem;">';
      chartData.forEach((value, index) => {
        const height = (value / Math.max(...chartData)) * 140;
        const color = value > stats.rate ? 'var(--success)' : value < stats.rate - 1 ? '#dc3545' : 'var(--primary)';
        content += `<div style="flex: 1; background: ${color}; height: ${height}px; border-radius: 2px 2px 0 0; opacity: 0.8;"></div>`;
      });
      content += '</div>';
      
      // Chart labels
      content += '<div style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.8rem; color: var(--muted);">';
      content += '<span>30 days ago</span><span>Today</span>';
      content += '</div>';
      
      // Chart legend
      content += '<div style="display: flex; gap: 1rem; margin-top: 1rem; font-size: 0.9rem;">';
      content += '<div style="display: flex; align-items: center; gap: 0.5rem;"><div style="width: 12px; height: 12px; background: var(--success); border-radius: 2px;"></div>Above Average</div>';
      content += '<div style="display: flex; align-items: center; gap: 0.5rem;"><div style="width: 12px; height: 12px; background: var(--primary); border-radius: 2px;"></div>Average</div>';
      content += '<div style="display: flex; align-items: center; gap: 0.5rem;"><div style="width: 12px; height: 12px; background: #dc3545; border-radius: 2px;"></div>Below Average</div>';
      content += '</div>';
      
      content += '</div></div>';
      
      // Step Performance
      content += '<div style="background: white; padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border); margin-bottom: 2rem;">';
      content += '<h3>Step-by-Step Performance</h3>';
      content += '<div style="overflow-x: auto; margin-top: 1rem;">';
      content += '<table style="width: 100%; border-collapse: collapse;">';
      content += '<thead><tr style="border-bottom: 2px solid var(--border);">';
      content += '<th style="text-align: left; padding: 1rem;">Step</th>';
      content += '<th style="text-align: right; padding: 1rem;">Views</th>';
      content += '<th style="text-align: right; padding: 1rem;">Completions</th>';
      content += '<th style="text-align: right; padding: 1rem;">Drop-off Rate</th>';
      content += '</tr></thead><tbody>';
      
      stats.stepPerformance.forEach((step, index) => {
        content += `<tr style="border-bottom: 1px solid var(--border);">`;
        content += `<td style="padding: 1rem;">Step ${index + 1}: ${step.name}</td>`;
        content += `<td style="text-align: right; padding: 1rem;">${step.views.toLocaleString()}</td>`;
        content += `<td style="text-align: right; padding: 1rem;">${step.completions.toLocaleString()}</td>`;
        content += `<td style="text-align: right; padding: 1rem; color: ${step.dropOff > 20 ? '#dc3545' : 'var(--success)'};">${step.dropOff}%</td>`;
        content += `</tr>`;
      });
      
      content += '</tbody></table></div></div>';
      
      // Recent Activity
      content += '<div style="background: white; padding: 2rem; border-radius: var(--radius); border: 1px solid var(--border);">';
      content += '<h3>Recent Activity</h3>';
      content += '<div style="margin-top: 1rem;">';
      stats.recentActivity.forEach(activity => {
        content += `<div style="display: flex; justify-content: space-between; align-items: center; padding: 1rem; border-bottom: 1px solid var(--border);">`;
        content += `<div><strong>${activity.user}</strong> ${activity.action}</div>`;
        content += `<div style="color: var(--muted); font-size: 0.9rem;">${activity.time}</div>`;
        content += `</div>`;
      });
      content += '</div></div>';
      
      document.getElementById('stats-content').innerHTML = content;
      document.getElementById('stats-modal').style.display = 'block';
    }

    function generateFlowStats(flowName) {
      // Generate realistic stats based on flow type
      const baseStats = {
        'Welcome Flow': { views: 2847, conversions: 243, rate: 8.5, revenue: 19201 },
        'Upgrade Prompt': { views: 1523, conversions: 187, rate: 12.3, revenue: 14789 },
        'Feature Announcement': { views: 892, conversions: 54, rate: 6.1, revenue: 4266 }
      };
      
      const base = baseStats[flowName] || { views: 1234, conversions: 89, rate: 7.2, revenue: 7031 };
      
      return {
        views: base.views,
        conversions: base.conversions,
        rate: base.rate,
        revenue: base.revenue,
        viewsGrowth: Math.floor(Math.random() * 25) + 5,
        conversionsGrowth: Math.floor(Math.random() * 30) + 10,
        rateGrowth: (Math.random() * 3 + 0.5).toFixed(1),
        revenueGrowth: Math.floor(Math.random() * 2000) + 500,
        stepPerformance: [
          { name: 'Initial View', views: base.views, completions: Math.floor(base.views * 0.85), dropOff: 15 },
          { name: 'Engagement', views: Math.floor(base.views * 0.85), completions: Math.floor(base.views * 0.65), dropOff: 24 },
          { name: 'Conversion', views: Math.floor(base.views * 0.65), completions: base.conversions, dropOff: Math.floor((1 - base.conversions / (base.views * 0.65)) * 100) }
        ],
        recentActivity: [
          { user: 'Sarah Chen', action: 'completed the flow', time: '2 minutes ago' },
          { user: 'Mike Johnson', action: 'started the flow', time: '5 minutes ago' },
          { user: 'Emma Wilson', action: 'completed the flow', time: '12 minutes ago' },
          { user: 'David Brown', action: 'dropped off at step 2', time: '18 minutes ago' }
        ]
      };
    }

    function closeStatsModal() {
      document.getElementById('stats-modal').style.display = 'none';
    }
  </script>
</body>
</html>